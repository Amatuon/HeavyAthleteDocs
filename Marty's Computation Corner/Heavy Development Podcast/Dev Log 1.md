Welcome to the first dev log of Heavy Athlete. I am Michael McDougal the creator of Heavy Athlete. You may know me better as Marty the Scottish Mermaid. 

In a normal first episode you might of expected me to talk about how we got here. I'm skipping all that jumping straight to the current problems I'm trying to solve.

There are a number of new features I want to add as well as a bunch of QOL improvements I want to make on the site. 
Lets talk QOL first:
- I want to improve the score entry experience. Right now Scores are entered in batches which works well for our single underpowered server but means that it is easy to lose work. I want to have Scores update on the server as you move from box to box so the most amount of work you can lose is a single number. This would blow up our current server.
- This same approach would apply to classes and flights as well.
- I also want to add the ability to reorder athletes and flights via a drag and drop system so that ADs have fine control over how data is presented. This would also let you match the score entry screen to your physical paper as well so that you can enter scores faster.
 - I want to improve the experience when using Throw Replay. Currently you have to upload and download files manually which isn't a great experience. I'm going to make it so that video / model transfers happen in the back ground like magic.
 
Okay now new features:
- I want to add image support the site and potentially dabble into video. You can technically enter photos already but you have to host them elsewhere. I have a tool available for free on the site to help with this but it would be way cleaner to just let folks upload the image to us directly. This isn't a thing yet because our server has a limited monthly data transfer amount and images would shred it.
- Next a long awaited feature is proper live scoring for games. The idea is that you as an AD and your Judges download a free app. You sign in to Heavy Athlete on the app. You then get a code to share with your judges. I'm think about making them 6 letter codes like you get via text to validate its you. Then you as AD already have your classes and flights set up in Heavy Athlete. You can assign a group of flights to a judge. Their app will have only the data they need. As they enter scores their app will talk with Heavy Athlete and enter the scores live but grayed out. As the AD you will have a master view of everything on your app. When you are happy that there are no errors, you can validate the scores and then they go from gray to black on the site. Gray scores wont affect rankings. That's to make sure you validate your scores. I'm sure athletes will police this for me to see their rankings go up. There will also be a version of the app for your Master of Ceremonies. In addition to live score reports, they will have access to athlete bios and photos so they can tell who they are talking about and talk about folks like they have known them for more that 3 seconds. The MC version of the app will also have all the history and trivia for the games as well as the classic jokes to help them fill down time. I think these will help the games a ton. Imagine better announcing and not having to wait an hour at the end of the game for the AD to tally points.

There are lots of other things in the works but I wanted to focus on these because they all have the same bottleneck. Our current server is too weak.

So lets talk about the current server so we can understand the problem.
We run on a $5 a month Linode shared CPU instance. In the evenings during peak usage our CPU holds pretty steady at 60% usage. On the data transfer front we have also skyrocketed recently. We are now serving 2 GB of text a day. At 30 days in a month that's 60 GB a month. Now Linode is pretty generous here and our limit is 1000 GB a month. So no big deal right we are still using less than 1% of the data pool? Well remember I said we were on a shared CPU, basically we are running in a virtual machine. That data pool of 1000 GB isn't ours its our host machine. Currently if there are any other servers running on our host machine then their websites must suck because they aren't affecting the pool much. However I can't rely on this. Linode is very clear that on a shared CPU you can be moved to a different host machine and that others may come to your machine. While this isn't a huge deal yet I'd rather cut it off at the pass since our CPU is becoming a bottleneck anyway.

Now for the solution. I have a cluster of four raspberry pi 4s from a previous project. Each pi has 4 cores and each core is roughly equivalent in power to the Linode I'm renting. My plan is to take the site offline temporarily, transfer the most current version of the database to the primary pi and restart the site running on that. This will give us immediately 4x as much CPU breathing room. Since we are using roughly half during peak hours that means that we should be able to handle 16x more concurrent users. I'm going to be conservative and call that a 10x improvement.

There are also 3 more pis in the cluster though. The remaining three are going to share the load of images, video, and Throw Replay. By setting up some network attached storage all three pis can all have access to the same image and video data as well as the athlete models that make throw replay work. That means they can work together and handle a lot of requests simultaneously. 

When I make this transition I am going to keep the Linode server for about a week, I have already paid for it for the month after all, then retire it. I had initially wanted to leave it running as a read only back up incase the pi cluster lost power or internet. I decided against this though. The problem arises from from two points scale and cost. First lets do scale. Even as a back up as the site continues to grow I think that we will quickly pass the point that the Linode can handle on its CPU. So its kind of a bad backup if it when we need to switch to it it fails. Second is cost. Load balancing isn't free. To start load balancing on Cloudflare cost $5 a month. Wait let me explain how I would use a load balancer. Basically it would send all the traffic to the pi cluster but if it detects that the cluster is down it would fall back to the Linode. Okay so that feature costs $5 a month. That's not a huge deal to improve uptime we have to pay $10 a month instead of $5 no big deal. Until you read the fine print. Cloudflare's load balancing comes with half a million requests covered by your $5 a month then each additional half million requests cost 50 cents. Well that sounds pretty cheap honestly so how many requests does Heavy Athlete serve a month. Well Cloudflare has that answer for me. Last month we served 8.59 million requests. Doing the math is easy that would be an additional $8.50 but the first 50 cents worth are free or more accurately cost the $5 cover charge. Factoring that in the total is $13 dollars a month. That's still not terrible but there is a deal breaker in there for me. That number can grow without bounds. If someone scrapped the site for data. Which is against the TOS by the way, yes I've noticed you person trying to send POST request to the homepage like I was NASGA. But if someone scrapped the site they could rack up a huge bill for me. Additionally the whole reason for this is I am expecting the traffic to double soon as we keep reaching more widespread adoption and our Linode wouldn't be able to handle it. So if we simple double the requests that's another $8.50 a month bringing us up to $21.50 a month just to send data to a $5 a month computer that can't handle it anyway. The final nail in the coffin though is that with the large CPU pool of the pi cluster I will actually be able to implement the QOL features I mentioned earlier. Those are going to make the frontend and backend chat a lot more which means even more requests to handle what I am already doing now. I cant give you a number about the increase there but based off of gut feeling, user breakdown, and speculation about how the site will be used moving forward lets call it an additional 10% increase in requests. That's another $2. So to add load balancing, aka a backup to the pis, all said and done should cost me nearly $30 a month after we out grow the Linode. And I know that adding these new features will only hasten that process. So that's a projected $360 a year that can actually grow higher all to have a back up service that wont actually handle the load. The alternative is I just fold the Linode server and send all the traffic to the pi cluster that only costs me electricity for the pis for a year.

So while I expect that the uptime of the site should stay pretty high. If there is a big storm in Virginia the site might go down for a while. I simply unwilling to pay that kind of money for something that wouldn't even do its job well anyways.

Now I'm a solo developer. So my decisions pull in technical details but I am also CEO of Dark Stranger LLC which is the company that owns Heavy Athlete. So a lot of my decisions also pull on business decisions. Are there better ways so that I can guarantee 100% up time? Yes. Are they the right fit for a small company that offers the preponderance of its service for free? No. To the more software oriented listeners visit the site and notice what is behind a paywall and what isn't. Then notice that I don't run generic ads. Go ahead turn off your ad blocker they just aren't there to begin with. The only company I can think of with a free tear as generous as mine is Google. But I still beat them because I don't sell user data. So no I actually want people to tell me if another business not a charity another for profit entity offers as good of a free tier as me. 

Wow sorry I got off topic there. What I was trying to say is my perspective is what's right for my company and yours may decide to go in a different direction. 

If you liked this tune in for more dev logs I promise that I'll be talking about cool technical details about the site. If you have been saddled with this as my replacement after I die and you are listening to this to try to understand the decisions that went into making the wild ride you got yourself into. Thank you, I'm sorry and may God help you.

This has been Michael McDougal from Heavy Athlete. I'll see you next time after I break some more things.